# æ€æºç¬”è®°åŒæ­¥æ’ä»¶ v1.3.2 Release Notes

## ðŸ› å…³é”®ä¿®å¤

### MD5è®¡ç®—é”™è¯¯ä¿®å¤
**é—®é¢˜**: ç”¨æˆ·æŠ¥å‘Šåœ¨å¤‡ä»½æ—¶å‡ºçŽ° "åˆ†ç‰‡ 1 ä¸Šä¼ å¤±è´¥: æ ¡éªŒæ–‡ä»¶MD5ä¸ŽæœŸæœ›MD5ä¸ä¸€è‡´" é”™è¯¯

**æ ¹æœ¬åŽŸå› **: 
- è‡ªå®šä¹‰çš„æµå¼MD5è®¡ç®—å®žçŽ°å­˜åœ¨ç®—æ³•é”™è¯¯
- åœ¨å¤„ç†æ–‡ä»¶paddingæ—¶è®¡ç®—ä¸å‡†ç¡®
- å¯¼è‡´æœ¬åœ°è®¡ç®—çš„MD5ä¸ŽæœåŠ¡å™¨ç«¯ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**:
- âœ… æ›¿æ¢è‡ªå®šä¹‰MD5å®žçŽ°ä¸º `spark-md5` åº“ï¼ˆç»è¿‡å……åˆ†éªŒè¯çš„MD5å®žçŽ°ï¼‰
- âœ… ä¿æŒæµå¼å¤„ç†æ–¹å¼ï¼Œé¿å…å¤§æ–‡ä»¶å†…å­˜é—®é¢˜
- âœ… æ·»åŠ è¯¦ç»†çš„ä¸Šä¼ æ—¥å¿—ç”¨äºŽé—®é¢˜è¯Šæ–­

**éªŒè¯ç»“æžœ**:
```bash
=== Spark-MD5 å‡†ç¡®æ€§æµ‹è¯• ===

ðŸ“„ æµ‹è¯•æ–‡ä»¶: ./package.json
   å¤§å°: 962 bytes (0.00 MB)
   æ ‡å‡†MD5: d8bc7c8e28db018bf14213fcec400f4f
   Spark MD5: d8bc7c8e28db018bf14213fcec400f4f
   âœ… MD5åŒ¹é…

ðŸ“„ æµ‹è¯•æ–‡ä»¶: ./dist/index.js
   å¤§å°: 173184 bytes (0.17 MB)
   æ ‡å‡†MD5: 17b41bac79eaf618544e26c9e006536d
   Spark MD5: 17b41bac79eaf618544e26c9e006536d
   âœ… MD5åŒ¹é…

âœ… æ‰€æœ‰å·²çŸ¥MD5å€¼æµ‹è¯•é€šè¿‡
```

## ðŸ”§ æŠ€æœ¯æ”¹è¿›

### 1. å¢žå¼ºçš„æ—¥å¿—ç³»ç»Ÿ
æ·»åŠ äº†è¯¦ç»†çš„ä¸Šä¼ å’Œæ ¡éªŒæ—¥å¿—ï¼š
```typescript
// ä¸Šä¼ ä¼šè¯åˆ›å»ºæ—¥å¿—
console.log(`[Pan123] åˆ›å»ºä¸Šä¼ ä»»åŠ¡: ${filename}, å¤§å°: ${size}, MD5: ${md5}`);

// åˆ†ç‰‡ä¸Šä¼ æ—¥å¿—
console.log(`[Pan123] åˆ†ç‰‡ ${sliceNo}: offset=${offset}, size=${size}, MD5=${md5}`);

// ä¸Šä¼ å“åº”æ—¥å¿—
console.log(`[Pan123] åˆ†ç‰‡ ${sliceNo} ä¸Šä¼ å“åº”:`, JSON.stringify(reply));

// åˆå¹¶åˆ†ç‰‡æ—¥å¿—
console.log(`[Pan123] åˆå¹¶åˆ†ç‰‡å“åº” (å°è¯• ${attempt}/${maxAttempts}):`, JSON.stringify(payload));
```

### 2. MD5è®¡ç®—ä¼˜åŒ–
```typescript
// ä½¿ç”¨spark-md5è¿›è¡Œæµå¼è®¡ç®—
export async function computeFileMd5Stream(
    file: File,
    chunkSize = 2 * 1024 * 1024,
    onProgress?: (progress: number) => void
): Promise<string> {
    const spark = new SparkMD5.ArrayBuffer();
    const fileSize = file.size;
    let offset = 0;

    while (offset < fileSize) {
        const end = Math.min(offset + chunkSize, fileSize);
        const chunk = file.slice(offset, end);
        const buffer = await chunk.arrayBuffer();
        
        spark.append(buffer);
        offset = end;
        
        if (onProgress) {
            onProgress((offset / fileSize) * 100);
        }
    }

    return spark.end().toLowerCase();
}
```

## ðŸ“¦ ä¾èµ–å˜æ›´

### æ–°å¢žä¾èµ–
- `spark-md5@3.0.2` - å¯é çš„MD5è®¡ç®—åº“
- `@types/spark-md5@3.0.5` (devDependency) - TypeScriptç±»åž‹å®šä¹‰

## ðŸ” é—®é¢˜è¯Šæ–­

å¦‚æžœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼ŒçŽ°åœ¨å¯ä»¥é€šè¿‡æµè§ˆå™¨æŽ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†çš„ä¸Šä¼ æ—¥å¿—ï¼š

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾
3. æ‰§è¡Œå¤‡ä»½æ“ä½œ
4. æŸ¥çœ‹ `[siyuan-sync]` å’Œ `[Pan123]` å¼€å¤´çš„æ—¥å¿—

å…³é”®è¯Šæ–­ä¿¡æ¯åŒ…æ‹¬ï¼š
- æ–‡ä»¶å¤§å°å’ŒMD5å€¼
- æ¯ä¸ªåˆ†ç‰‡çš„åç§»é‡ã€å¤§å°å’ŒMD5
- æœåŠ¡å™¨å“åº”çš„è¯¦ç»†å†…å®¹
- åˆå¹¶åˆ†ç‰‡çš„è¯¦ç»†çŠ¶æ€

## ðŸ“ æ›´æ–°å»ºè®®

**å¼ºçƒˆæŽ¨èæ‰€æœ‰ç”¨æˆ·æ›´æ–°åˆ°æ­¤ç‰ˆæœ¬**ï¼Œç‰¹åˆ«æ˜¯å¦‚æžœæ‚¨é‡åˆ°äº†ä»¥ä¸‹ä»»ä½•é—®é¢˜ï¼š
- âŒ "æ ¡éªŒæ–‡ä»¶MD5ä¸ŽæœŸæœ›MD5ä¸ä¸€è‡´"
- âŒ åˆ†ç‰‡ä¸Šä¼ å¤±è´¥
- âŒ å¤‡ä»½å¤±è´¥ä½†æ— æ˜Žç¡®é”™è¯¯ä¿¡æ¯

## ðŸ™ è‡´è°¢

æ„Ÿè°¢ç”¨æˆ·æŠ¥å‘Šæ­¤é—®é¢˜å¹¶æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œè¿™å¯¹äºŽå®šä½å’Œä¿®å¤é—®é¢˜è‡³å…³é‡è¦ã€‚

---

**å®Œæ•´æ›´æ–°æ—¥å¿—**: https://github.com/Spritualkb/siyuan-sync/compare/v1.3.1...v1.3.2

